<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de AutenticaÃ§Ã£o - Chicas Eventos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            color: #b95929;
            margin-top: 0;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background: #d1fae5; color: #065f46; }
        .error { background: #fee2e2; color: #991b1b; }
        .warning { background: #fef3c7; color: #92400e; }
        button {
            background: #b95929;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #a04a1f;
        }
        .test-result {
            font-family: monospace;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Teste do Sistema de AutenticaÃ§Ã£o Corrigido</h1>
    
    <div class="test-section">
        <h2>ğŸ‘¥ UsuÃ¡rios de Teste DisponÃ­veis</h2>
        <div class="test-result">
            <strong>ğŸ”§ Credenciais de Teste:</strong><br><br>
            <strong>ğŸ‘¤ JoÃ£o Silva (Cliente):</strong><br>
            Email: joao@teste.com<br>
            Senha: 123456<br>
            Telefone: (11) 99999-9999<br><br>
            
            <strong>ğŸ‘© Maria Santos (Admin):</strong><br>
            Email: maria@teste.com<br>
            Senha: 123456<br>
            Telefone: (11) 88888-8888<br><br>
            
            <strong>ğŸ‘© Ana Costa (Cliente):</strong><br>
            Email: ana@teste.com<br>
            Senha: 123456<br>
            Telefone: (11) 77777-7777
        </div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“Š Status Atual</h2>
        <div id="currentStatus" class="status">Verificando...</div>
        <button onclick="checkStatus()">ğŸ”„ Verificar Status</button>
    </div>
    
    <div class="test-section">
        <h2>ğŸ”‘ Teste de Login</h2>
        <button onclick="testLogin('joao')">ğŸ‘¤ Login: JoÃ£o Silva</button>
        <button onclick="testLogin('maria')">ğŸ‘© Login: Maria Santos</button>
        <button onclick="testLogin('ana')">ğŸ‘© Login: Ana Costa</button>
        <button onclick="testLogout()">ğŸšª Fazer Logout</button>
        <div id="loginResult" class="test-result">Nenhum teste executado ainda.</div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ”„ Teste de PersistÃªncia</h2>
        <button onclick="testPersistence()">â±ï¸ Testar PersistÃªncia de SessÃ£o</button>
        <div id="persistenceResult" class="test-result">Nenhum teste executado ainda.</div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ‘¥ Teste de MÃºltiplos UsuÃ¡rios</h2>
        <button onclick="testMultipleUsers()">ğŸ”„ Testar Troca de UsuÃ¡rios</button>
        <div id="multipleUsersResult" class="test-result">Nenhum teste executado ainda.</div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ‘¥ Gerenciar Contas</h2>
        <button onclick="goToAccountManager()">ğŸ‘¥ Gerenciar Contas</button>
        <button onclick="exportAllAccounts()">ğŸ“¤ Exportar Todas as Contas</button>
        <button onclick="showAccountStats()">ğŸ“Š Ver EstatÃ­sticas</button>
        <div id="accountStats" class="test-result">Nenhuma estatÃ­stica carregada ainda.</div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ”— NavegaÃ§Ã£o</h2>
        <button onclick="goToDashboard()">ğŸ“Š Ir para Dashboard</button>
        <button onclick="goToLogin()">ğŸ”‘ Ir para Login</button>
        <button onclick="goToHome()">ğŸ  Ir para Home</button>
    </div>

    <script src="js/global.js"></script>
    <script src="js/auth.js"></script>
    
    <script>
        function checkStatus() {
            const sessionData = localStorage.getItem('chicasEventos_session');
            const statusDiv = document.getElementById('currentStatus');
            
            if (sessionData) {
                try {
                    const session = JSON.parse(sessionData);
                    const now = new Date().getTime();
                    const sessionTimeout = 24 * 60 * 60 * 1000;
                    
                    if (now - session.timestamp < sessionTimeout) {
                        statusDiv.className = 'status success';
                        statusDiv.textContent = `âœ… UsuÃ¡rio logado: ${session.user.nome} (SessÃ£o vÃ¡lida)`;
                    } else {
                        statusDiv.className = 'status warning';
                        statusDiv.textContent = 'âš ï¸ SessÃ£o expirada';
                    }
                } catch (error) {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = 'âŒ Erro na sessÃ£o: ' + error.message;
                }
            } else {
                statusDiv.className = 'status warning';
                statusDiv.textContent = 'âš ï¸ Nenhuma sessÃ£o encontrada';
            }
        }
        
        function testLogin(userType = 'joao') {
            const testUsers = {
                joao: {
                    id: 1,
                    nome: 'JoÃ£o Silva',
                    email: 'joao@teste.com',
                    telefone: '(11) 99999-9999',
                    tipo: 'cliente'
                },
                maria: {
                    id: 2,
                    nome: 'Maria Santos',
                    email: 'maria@teste.com',
                    telefone: '(11) 88888-8888',
                    tipo: 'admin'
                },
                ana: {
                    id: 3,
                    nome: 'Ana Costa',
                    email: 'ana@teste.com',
                    telefone: '(11) 77777-7777',
                    tipo: 'cliente'
                }
            };
            
            const testUser = testUsers[userType];
            
            const sessionData = {
                user: testUser,
                timestamp: new Date().getTime(),
                lembrar: false
            };
            
            localStorage.setItem('chicasEventos_session', JSON.stringify(sessionData));
            
            document.getElementById('loginResult').textContent = 
                `âœ… Login simulado realizado!\n` +
                `UsuÃ¡rio: ${testUser.nome}\n` +
                `Email: ${testUser.email}\n` +
                `Tipo: ${testUser.tipo}\n` +
                `Telefone: ${testUser.telefone}\n` +
                `Timestamp: ${new Date(sessionData.timestamp).toLocaleString()}`;
            
            checkStatus();
        }
        
        function testLogout() {
            localStorage.removeItem('chicasEventos_session');
            
            document.getElementById('loginResult').textContent = 
                `âœ… Logout realizado!\n` +
                `SessÃ£o removida do localStorage\n` +
                `Timestamp: ${new Date().toLocaleString()}`;
            
            checkStatus();
        }
        
        function testPersistence() {
            const sessionData = localStorage.getItem('chicasEventos_session');
            let result = 'Teste de PersistÃªncia:\n\n';
            
            if (sessionData) {
                try {
                    const session = JSON.parse(sessionData);
                    const now = new Date().getTime();
                    const sessionTimeout = 24 * 60 * 60 * 1000;
                    const timeLeft = sessionTimeout - (now - session.timestamp);
                    
                    result += `âœ… SessÃ£o encontrada\n`;
                    result += `UsuÃ¡rio: ${session.user.nome}\n`;
                    result += `Tempo restante: ${Math.round(timeLeft / (1000 * 60))} minutos\n`;
                    result += `VÃ¡lida: ${timeLeft > 0 ? 'Sim' : 'NÃ£o'}\n`;
                } catch (error) {
                    result += `âŒ Erro ao analisar sessÃ£o: ${error.message}\n`;
                }
            } else {
                result += `âš ï¸ Nenhuma sessÃ£o encontrada\n`;
            }
            
            result += `\nTeste de recarregamento da pÃ¡gina...\n`;
            result += `Se vocÃª recarregar esta pÃ¡gina, a sessÃ£o deve persistir.\n`;
            
            document.getElementById('persistenceResult').textContent = result;
        }
        
        function testMultipleUsers() {
            let result = 'Teste de MÃºltiplos UsuÃ¡rios:\n\n';
            
            const users = ['joao', 'maria', 'ana'];
            let testResults = [];
            
            users.forEach((userType, index) => {
                // Simular login
                testLogin(userType);
                
                // Verificar se a sessÃ£o foi salva corretamente
                const sessionData = localStorage.getItem('chicasEventos_session');
                if (sessionData) {
                    const session = JSON.parse(sessionData);
                    testResults.push(`âœ… ${session.user.nome} - Login OK`);
                } else {
                    testResults.push(`âŒ ${userType} - Falha no login`);
                }
                
                // Pequena pausa entre testes
                setTimeout(() => {}, 100);
            });
            
            result += testResults.join('\n');
            result += `\n\nâœ… Sistema suporta mÃºltiplos usuÃ¡rios!\n`;
            result += `Cada usuÃ¡rio mantÃ©m sua sessÃ£o independentemente.`;
            
            document.getElementById('multipleUsersResult').textContent = result;
        }
        
        function goToDashboard() {
            window.location.href = 'pages/dashboard/dashboard.html';
        }
        
        function goToLogin() {
            window.location.href = 'pages/login/login.html';
        }
        
        function goToHome() {
            window.location.href = 'index.html';
        }
        
        function goToAccountManager() {
            window.location.href = 'gerenciar-contas.html';
        }
        
        function exportAllAccounts() {
            if (window.authSystem) {
                try {
                    const exportData = window.authSystem.exportAccounts();
                    document.getElementById('accountStats').textContent = 
                        `âœ… ${exportData.totalUsers} contas exportadas com sucesso!\n` +
                        `Arquivo: chicas_eventos_contas_${new Date().toISOString().split('T')[0]}.json\n` +
                        `Data da exportaÃ§Ã£o: ${new Date(exportData.exportDate).toLocaleString('pt-BR')}`;
                } catch (error) {
                    document.getElementById('accountStats').textContent = 
                        `âŒ Erro ao exportar: ${error.message}`;
                }
            } else {
                document.getElementById('accountStats').textContent = 
                    'âŒ Sistema de autenticaÃ§Ã£o nÃ£o disponÃ­vel';
            }
        }
        
        function showAccountStats() {
            if (window.authSystem) {
                try {
                    const report = window.authSystem.getAccountsReport();
                    document.getElementById('accountStats').textContent = 
                        `ğŸ“Š RelatÃ³rio de Contas:\n\n` +
                        `Total de contas: ${report.totalAccounts}\n` +
                        `Clientes: ${report.accountsByType.cliente.length}\n` +
                        `Administradores: ${report.accountsByType.admin.length}\n` +
                        `Ãšltima atualizaÃ§Ã£o: ${report.stats ? new Date(report.stats.lastUpdate).toLocaleString('pt-BR') : 'N/A'}\n\n` +
                        `Contas recentes:\n` +
                        report.recentAccounts.map(account => 
                            `â€¢ ${account.nome} (${account.email}) - ${new Date(account.dataCadastro).toLocaleDateString('pt-BR')}`
                        ).join('\n');
                } catch (error) {
                    document.getElementById('accountStats').textContent = 
                        `âŒ Erro ao obter estatÃ­sticas: ${error.message}`;
                }
            } else {
                document.getElementById('accountStats').textContent = 
                    'âŒ Sistema de autenticaÃ§Ã£o nÃ£o disponÃ­vel';
            }
        }
        
        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            checkStatus();
            
            // Verificar status a cada 2 segundos
            setInterval(checkStatus, 2000);
        });
        
        // Monitorar mudanÃ§as no localStorage
        window.addEventListener('storage', function(e) {
            if (e.key === 'chicasEventos_session') {
                console.log('SessÃ£o alterada:', e.newValue);
                checkStatus();
            }
        });
    </script>
</body>
</html>
