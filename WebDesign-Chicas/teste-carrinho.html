<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Funcionalidade do Carrinho</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/modals.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #f8fafc;
        }
        .test-section h2 {
            margin-top: 0;
            color: #1e293b;
        }
        .test-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .test-btn {
            padding: 12px 16px;
            border: 1px solid #059669;
            border-radius: 6px;
            background: white;
            color: #059669;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        .test-btn:hover {
            background: #059669;
            color: white;
        }
        .status {
            padding: 8px 12px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: 500;
        }
        .status.success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }
        .status.error {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }
        .status.info {
            background: #eff6ff;
            color: #2563eb;
            border: 1px solid #bfdbfe;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🧪 Teste da Funcionalidade do Carrinho</h1>
        <p>Esta página testa a funcionalidade padronizada dos botões "Adicionar ao carrinho".</p>

        <!-- Status do Sistema -->
        <div class="test-section">
            <h2>📊 Status do Sistema</h2>
            <div id="systemStatus">
                <div class="status info">Carregando status...</div>
            </div>
        </div>

        <!-- Teste de Botões Padronizados -->
        <div class="test-section">
            <h2>🔘 Teste de Botões Padronizados</h2>
            <p>Estes botões usam a classe <code>.js-add-to-cart</code> e os atributos <code>data-*</code> padronizados:</p>
            
            <div class="test-buttons">
                <!-- Teste Package Buffet -->
                <button class="js-add-to-cart test-btn" 
                        data-item-type="package" 
                        data-item-id="buffet-ouro" 
                        data-variant-id="ouro" 
                        data-qty="50"
                        data-meta='{"serviceKey": "buffet", "title": "Buffet Ouro", "tier": "Ouro"}'>
                    📦 Buffet Ouro (50 pessoas)
                </button>

                <!-- Teste Service Audiovisual -->
                <button class="js-add-to-cart test-btn" 
                        data-item-type="service" 
                        data-item-id="fotografia" 
                        data-variant-id="4h" 
                        data-qty="1"
                        data-meta='{"serviceKey": "audiovisual", "title": "Fotografia", "duration": "4h"}'>
                    📸 Fotografia (4h)
                </button>

                <!-- Teste Service RH -->
                <button class="js-add-to-cart test-btn" 
                        data-item-type="service" 
                        data-item-id="garcom-bar" 
                        data-variant-id="6h" 
                        data-qty="2"
                        data-meta='{"serviceKey": "rh", "title": "Garçom/Bar", "duration": "6h"}'>
                    👥 Garçom/Bar (6h, 2 pessoas)
                </button>

                <!-- Teste Package Cerimonial -->
                <button class="js-add-to-cart test-btn" 
                        data-item-type="package" 
                        data-item-id="cerimonial-prata" 
                        data-variant-id="prata" 
                        data-qty="1"
                        data-meta='{"serviceKey": "cerimonial", "title": "Cerimonial Prata", "tier": "Prata"}'>
                    💍 Cerimonial Prata
                </button>
            </div>
        </div>

        <!-- Teste de Estados de Erro -->
        <div class="test-section">
            <h2>⚠️ Teste de Estados de Erro</h2>
            <p>Estes botões testam cenários de erro:</p>
            
            <div class="test-buttons">
                <!-- Botão sem userId (deve mostrar toast de login) -->
                <button class="js-add-to-cart test-btn" 
                        data-item-type="service" 
                        data-item-id="teste-sem-user"
                        data-variant-id="teste"
                        data-qty="1"
                        data-meta='{"test": "sem-user"}'>
                    🚫 Sem Usuário (Teste)
                </button>

                <!-- Botão com dados incompletos -->
                <button class="js-add-to-cart test-btn" 
                        data-item-type="service" 
                        data-item-id="" 
                        data-variant-id="teste"
                        data-qty="1"
                        data-meta='{"test": "dados-incompletos"}'>
                    ❌ Dados Incompletos
                </button>
            </div>
        </div>

        <!-- Teste de Modais -->
        <div class="test-section">
            <h2>🪟 Teste de Modais</h2>
            <p>Teste os modais que contêm os botões "Adicionar ao carrinho":</p>
            
            <div class="test-buttons">
                <button onclick="testOpenPackagesModal()" class="test-btn">
                    📦 Abrir Modal de Pacotes
                </button>
                <button onclick="testOpenItemModal()" class="test-btn">
                    🎯 Abrir Modal de Item
                </button>
            </div>
        </div>

        <!-- Informações do Carrinho -->
        <div class="test-section">
            <h2>🛒 Informações do Carrinho</h2>
            <div id="cartInfo">
                <div class="status info">Carregando informações do carrinho...</div>
            </div>
            <button onclick="updateCartInfo()" class="test-btn" style="margin-top: 10px;">
                🔄 Atualizar Info do Carrinho
            </button>
        </div>

        <!-- Log de Testes -->
        <div class="test-section">
            <h2>📝 Log de Testes</h2>
            <div id="testLog" style="background: white; padding: 15px; border-radius: 6px; border: 1px solid #e2e8f0; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;">
                <div>Log iniciado...</div>
            </div>
            <button onclick="clearLog()" class="test-btn" style="margin-top: 10px;">
                🗑️ Limpar Log
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/services-data.js"></script>
    <script src="assets/js/modals.js"></script>
    <script src="assets/js/carrinho.js"></script>
    
    <script>
        // Função para log
        function log(message, type = 'info') {
            const logDiv = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.color = type === 'error' ? '#dc2626' : type === 'success' ? '#166534' : '#2563eb';
            logEntry.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('testLog').innerHTML = '<div>Log limpo...</div>';
        }

        // Função para verificar status do sistema
        function checkSystemStatus() {
            const status = {
                carrinhoManager: !!window.carrinhoManager,
                addToCart: !!window.addToCart,
                modalManager: !!window.modalManager,
                servicesData: !!window.SERVICES_DATA
            };

            const statusDiv = document.getElementById('systemStatus');
            statusDiv.innerHTML = '';

            Object.entries(status).forEach(([key, value]) => {
                const div = document.createElement('div');
                div.className = `status ${value ? 'success' : 'error'}`;
                div.textContent = `${value ? '✅' : '❌'} ${key}: ${value ? 'Carregado' : 'Não encontrado'}`;
                statusDiv.appendChild(div);
            });

            log(`Status do sistema verificado: ${Object.values(status).filter(Boolean).length}/${Object.keys(status).length} componentes carregados`);
        }

        // Função para atualizar informações do carrinho
        function updateCartInfo() {
            if (!window.carrinhoManager) {
                document.getElementById('cartInfo').innerHTML = '<div class="status error">❌ CarrinhoManager não encontrado</div>';
                return;
            }

            const carrinho = window.carrinhoManager.carrinho;
            const userId = window.carrinhoManager.userId;
            const totalItens = carrinho.reduce((total, item) => total + item.quantidade, 0);

            document.getElementById('cartInfo').innerHTML = `
                <div class="status success">✅ Usuário: ${userId || 'Guest'}</div>
                <div class="status info">📦 Total de itens: ${totalItens}</div>
                <div class="status info">🛍️ Itens únicos: ${carrinho.length}</div>
                <div style="margin-top: 10px;">
                    <strong>Itens no carrinho:</strong>
                    ${carrinho.length === 0 ? '<div class="status info">Carrinho vazio</div>' : 
                      carrinho.map(item => `<div style="margin: 5px 0; padding: 5px; background: white; border-radius: 4px;">${item.nome} (${item.quantidade}x) - R$ ${item.preco}</div>`).join('')}
                </div>
            `;

            log(`Carrinho atualizado: ${totalItens} itens, ${carrinho.length} únicos`);
        }

        // Função para testar modal de pacotes
        function testOpenPackagesModal() {
            log('Abrindo modal de pacotes...');
            try {
                // Simular dados de serviço para teste
                window.currentServiceData = {
                    serviceKey: 'buffet',
                    title: 'Buffet',
                    packages: [
                        {
                            id: 'buffet-bronze',
                            title: 'Buffet Bronze',
                            tierOrService: 'Bronze',
                            description: 'Pacote básico de buffet',
                            offerings: ['Cardápio básico', 'Serviço de mesa'],
                            pricing: { 'Até 50 pessoas': 'R$ 45,00/pessoa' }
                        }
                    ]
                };
                openPackagesModal();
                log('Modal de pacotes aberto com sucesso', 'success');
            } catch (error) {
                log(`Erro ao abrir modal de pacotes: ${error.message}`, 'error');
            }
        }

        // Função para testar modal de item
        function testOpenItemModal() {
            log('Abrindo modal de item...');
            try {
                openItemModal('fotografia');
                log('Modal de item aberto com sucesso', 'success');
            } catch (error) {
                log(`Erro ao abrir modal de item: ${error.message}`, 'error');
            }
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            log('Página de teste carregada');
            checkSystemStatus();
            updateCartInfo();

            // Verificar se os event listeners estão funcionando
            setTimeout(() => {
                const addToCartButtons = document.querySelectorAll('.js-add-to-cart');
                log(`${addToCartButtons.length} botões .js-add-to-cart encontrados`);
                
                addToCartButtons.forEach((btn, index) => {
                    log(`Botão ${index + 1}: ${btn.dataset.itemType} - ${btn.dataset.itemId}`);
                });
            }, 1000);
        });

        // Interceptar cliques nos botões para log
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('js-add-to-cart')) {
                log(`Botão clicado: ${e.target.textContent.trim()}`);
            }
        });
    </script>
</body>
</html>