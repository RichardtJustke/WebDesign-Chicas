<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Login - Chicas Eventos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .error-message {
            background: #fee2e2;
            border: 1px solid #fca5a5;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            color: #991b1b;
        }
        .success-message {
            background: #d1fae5;
            border: 1px solid #a7f3d0;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            color: #065f46;
        }
        .btn {
            background: #b95929;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover { background: #a04a22; }
        .btn-success { background: #28a745; }
        .btn-danger { background: #dc3545; }
        .btn-info { background: #17a2b8; }
        
        .test-form {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .form-group {
            margin: 10px 0;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .status-card {
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        
        .status-card.error { background: #f8d7da; border-color: #f5c6cb; }
        .status-card.success { background: #d4edda; border-color: #c3e6cb; }
        .status-card.warning { background: #fff3cd; border-color: #ffeaa7; }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>üîç Debug do Problema de Login - Chicas Eventos</h1>
        <p>Vamos investigar por que o login n√£o est√° funcionando.</p>
        
        <div class="error-message">
            <h3>‚ùå Problema Identificado</h3>
            <p>O login n√£o est√° funcionando mesmo com as contas de teste. Vamos diagnosticar o problema.</p>
        </div>
    </div>

    <div class="debug-container">
        <h2>üìä Status dos Sistemas</h2>
        <div class="status-grid">
            <div class="status-card" id="auth-status">
                <h3>üîê Sistema de Autentica√ß√£o</h3>
                <div id="auth-info">Verificando...</div>
            </div>
            
            <div class="status-card" id="storage-status">
                <h3>üíæ Armazenamento</h3>
                <div id="storage-info">Verificando...</div>
            </div>
        </div>
    </div>

    <div class="debug-container">
        <h2>üß™ Teste de Login com Debug</h2>
        <div class="test-form">
            <div class="form-group">
                <label for="debug-email">Email:</label>
                <input type="email" id="debug-email" value="joao@teste.com" placeholder="Digite o email">
            </div>
            <div class="form-group">
                <label for="debug-password">Senha:</label>
                <input type="password" id="debug-password" value="123456" placeholder="Digite a senha">
            </div>
            <button class="btn btn-success" onclick="debugLogin()">üîç Debug Login</button>
            <button class="btn" onclick="testAllCredentials()">üë• Testar Todas as Credenciais</button>
            <button class="btn btn-info" onclick="checkSystemStatus()">üìä Verificar Status</button>
            <button class="btn btn-danger" onclick="resetSystem()">üîÑ Resetar Sistema</button>
        </div>
    </div>

    <div class="debug-container">
        <h2>üë• Usu√°rios de Teste</h2>
        <div class="test-form">
            <p><strong>üîß Credenciais de Teste:</strong></p>
            <p><strong>üë§ Jo√£o Silva (Cliente):</strong> joao@teste.com / 123456</p>
            <p><strong>üë© Maria Santos (Admin):</strong> maria@teste.com / 123456</p>
            <p><strong>üë© Ana Costa (Cliente):</strong> ana@teste.com / 123456</p>
        </div>
    </div>

    <div class="debug-container">
        <h2>üìù Log de Debug</h2>
        <div id="debug-log" class="log">Aguardando debug...</div>
    </div>

    <!-- Incluir scripts necess√°rios -->
    <script src="js/global.js"></script>
    <script src="js/auth-new.js"></script>
    <script src="js/navbar.js"></script>

    <script>
        let debugLog = document.getElementById('debug-log');
        let authStatus = document.getElementById('auth-status');
        let storageStatus = document.getElementById('storage-status');

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            debugLog.textContent += `[${timestamp}] ${message}\n`;
            debugLog.scrollTop = debugLog.scrollHeight;
            console.log(message);
        }

        function updateAuthStatus() {
            let authInfo = '';
            
            if (window.newAuthSystem) {
                authInfo += `<div style="color: green;">‚úÖ newAuthSystem carregado</div>`;
                authInfo += `<div><strong>Usu√°rio atual:</strong> ${window.newAuthSystem.currentUser ? window.newAuthSystem.currentUser.nome : 'Nenhum'}</div>`;
                authInfo += `<div><strong>Logado:</strong> ${window.newAuthSystem.isLoggedIn ? 'Sim' : 'N√£o'}</div>`;
                authInfo += `<div><strong>M√©todos:</strong> authenticateUser, login, logout</div>`;
            } else {
                authInfo += `<div style="color: red;">‚ùå newAuthSystem n√£o carregado</div>`;
            }
            
            if (window.authSystem) {
                authInfo += `<div style="color: orange;">‚ö†Ô∏è authSystem antigo ainda presente</div>`;
            }
            
            authStatus.innerHTML = `
                <h3>üîê Sistema de Autentica√ß√£o</h3>
                ${authInfo}
            `;
        }

        function updateStorageStatus() {
            let storageInfo = '';
            
            // Verificar localStorage
            try {
                const sessionData = localStorage.getItem('chicasEventos_session');
                const usersData = localStorage.getItem('chicasEventos_users');
                
                if (sessionData) {
                    storageInfo += `<div style="color: blue;">‚ÑπÔ∏è Sess√£o ativa encontrada</div>`;
                } else {
                    storageInfo += `<div style="color: gray;">‚ÑπÔ∏è Nenhuma sess√£o ativa</div>`;
                }
                
                if (usersData) {
                    const users = JSON.parse(usersData);
                    storageInfo += `<div style="color: green;">‚úÖ ${users.length} usu√°rios salvos</div>`;
                } else {
                    storageInfo += `<div style="color: orange;">‚ö†Ô∏è Nenhum usu√°rio salvo</div>`;
                }
                
                storageInfo += `<div><strong>localStorage dispon√≠vel:</strong> ${typeof Storage !== 'undefined' ? 'Sim' : 'N√£o'}</div>`;
                
            } catch (error) {
                storageInfo += `<div style="color: red;">‚ùå Erro no localStorage: ${error.message}</div>`;
            }
            
            storageStatus.innerHTML = `
                <h3>üíæ Armazenamento</h3>
                ${storageInfo}
            `;
        }

        function checkSystemStatus() {
            log('üîç Verificando status do sistema...');
            updateAuthStatus();
            updateStorageStatus();
            log('‚úÖ Status verificado');
        }

        async function debugLogin() {
            const email = document.getElementById('debug-email').value;
            const password = document.getElementById('debug-password').value;
            
            log(`üîë Iniciando debug de login: ${email}`);
            
            if (!window.newAuthSystem) {
                log('‚ùå ERRO: newAuthSystem n√£o est√° dispon√≠vel!');
                log('üîß Tentando carregar manualmente...');
                
                // Tentar carregar o sistema manualmente
                try {
                    if (typeof NewAuthSystem !== 'undefined') {
                        window.newAuthSystem = new NewAuthSystem();
                        log('‚úÖ Sistema carregado manualmente');
                    } else {
                        log('‚ùå NewAuthSystem n√£o est√° definido');
                        return;
                    }
                } catch (error) {
                    log(`‚ùå Erro ao carregar sistema: ${error.message}`);
                    return;
                }
            }
            
            try {
                log('üîÑ Chamando authenticateUser...');
                const user = await window.newAuthSystem.authenticateUser(email, password);
                
                if (user) {
                    log('‚úÖ Usu√°rio autenticado com sucesso!');
                    log(`üë§ Nome: ${user.nome}`);
                    log(`üìß Email: ${user.email}`);
                    log(`üë• Tipo: ${user.tipo}`);
                    
                    log('üîÑ Fazendo login...');
                    window.newAuthSystem.login(user, false);
                    log('‚úÖ Login realizado!');
                    
                    checkSystemStatus();
                } else {
                    log('‚ùå Usu√°rio n√£o encontrado ou credenciais inv√°lidas');
                    log('üîç Verificando usu√°rios salvos...');
                    
                    const users = window.newAuthSystem.getStoredUsers();
                    log(`üë• Usu√°rios salvos: ${users.length}`);
                    users.forEach(u => {
                        log(`  - ${u.nome} (${u.email}) - Ativo: ${u.ativo !== false}`);
                    });
                }
                
            } catch (error) {
                log(`‚ùå Erro durante autentica√ß√£o: ${error.message}`);
                log(`Stack trace: ${error.stack}`);
            }
        }

        async function testAllCredentials() {
            const testUsers = [
                { name: 'Jo√£o Silva', email: 'joao@teste.com', password: '123456' },
                { name: 'Maria Santos', email: 'maria@teste.com', password: '123456' },
                { name: 'Ana Costa', email: 'ana@teste.com', password: '123456' }
            ];
            
            log('üë• Testando todas as credenciais...');
            
            for (const user of testUsers) {
                log(`\nüîÑ Testando: ${user.name} (${user.email})`);
                
                try {
                    const authUser = await window.newAuthSystem.authenticateUser(user.email, user.password);
                    
                    if (authUser) {
                        log(`‚úÖ ${user.name} - Autentica√ß√£o OK`);
                        log(`   Nome: ${authUser.nome}, Tipo: ${authUser.tipo}`);
                    } else {
                        log(`‚ùå ${user.name} - Falha na autentica√ß√£o`);
                    }
                } catch (error) {
                    log(`‚ùå ${user.name} - Erro: ${error.message}`);
                }
            }
            
            log('\n‚úÖ Teste de credenciais conclu√≠do');
        }

        function resetSystem() {
            if (confirm('Tem certeza que deseja resetar o sistema?')) {
                log('üîÑ Resetando sistema...');
                
                // Limpar localStorage
                localStorage.clear();
                log('‚úÖ localStorage limpo');
                
                // Resetar sistemas
                if (window.newAuthSystem) {
                    window.newAuthSystem.currentUser = null;
                    window.newAuthSystem.isLoggedIn = false;
                    log('‚úÖ newAuthSystem resetado');
                }
                
                if (window.authSystem) {
                    window.authSystem.currentUser = null;
                    window.authSystem.isLoggedIn = false;
                    log('‚úÖ authSystem resetado');
                }
                
                checkSystemStatus();
                log('‚úÖ Sistema resetado');
            }
        }

        // Verificar status inicial
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Debug de login iniciado');
            
            setTimeout(() => {
                checkSystemStatus();
                log('‚úÖ Status inicial verificado');
            }, 1000);
        });
    </script>
</body>
</html>
